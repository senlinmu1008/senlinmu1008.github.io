"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));window.addEventListener("load",function(){function e(){var e=document.body.style;e.width="100%",e.overflow="hidden",btf.animateIn(document.getElementById("search-mask"),"to_show 0.5s"),btf.animateIn(document.querySelector("#local-search .search-dialog"),"titleScale 0.5s"),setTimeout(function(){document.querySelector("#local-search-input input").focus()},100),r||(function(){a.apply(this,arguments)}(GLOBAL_CONFIG.localSearch.path),r=!0),document.addEventListener("keydown",function e(t){"Escape"===t.code&&(n(),document.removeEventListener("keydown",e))})}function t(){document.querySelector("#search-button > .search").addEventListener("click",e),document.getElementById("search-mask").addEventListener("click",n),document.querySelector("#local-search .search-close-button").addEventListener("click",n)}var r=!1,n=function(){var e=document.body.style;e.width="",e.overflow="",btf.animateOut(document.querySelector("#local-search .search-dialog"),"search_close .5s"),btf.animateOut(document.getElementById("search-mask"),"to_hide 0.5s")};function a(){return(a=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function e(t){var r,n,a,o,c,s,l,i;return _regenerator.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],n=t.split(".")[1],e.next=4,fetch(GLOBAL_CONFIG.root+t);case 4:if(a=e.sent,"json"===n)return e.next=8,a.json();e.next=11;break;case 8:r=e.sent,e.next=22;break;case 11:if("xml"===n)return e.next=14,a.text();e.next=22;break;case 14:return o=e.sent,e.next=17,(new window.DOMParser).parseFromString(o,"text/xml");case 17:return c=e.sent,e.next=20,c;case 20:c=e.sent,r=(0,_toConsumableArray2.default)(c.querySelectorAll("entry")).map(function(e){return{title:e.querySelector("title").textContent,content:e.querySelector("content")&&e.querySelector("content").textContent,url:e.querySelector("url").textContent}});case 22:a.ok&&((s=document.getElementById("loading-database")).nextElementSibling.style.display="block",s.remove()),s=document.querySelector("#local-search-input input"),l=document.getElementById("local-search-results"),i=document.getElementById("loading-status"),s.addEventListener("input",function(){var u=this.value.trim().toLowerCase().split(/[\s]+/);""!==u[0]&&(i.innerHTML='<i class="fas fa-spinner fa-pulse"></i>'),l.innerHTML="";var d,m='<div class="search-result-list">';u.length<=0||(d=0,r.forEach(function(e){var r,t,n,a=!0,o=e.title?e.title.trim().toLowerCase():"",c=e.content?e.content.trim().replace(/<[^>]+>/g,"").toLowerCase():"",s=e.url.startsWith("/")?e.url:GLOBAL_CONFIG.root+e.url,l=-1,i=-1;""!==o||""!==c?u.forEach(function(e,t){r=o.indexOf(e),l=c.indexOf(e),r<0&&l<0?a=!1:(l<0&&(l=0),0===t&&(i=l))}):a=!1,a&&(0<=i&&(t=i+100,(e=i-30)<0&&(e=0),0===e&&(t=100),t>c.length&&(t=c.length),n=c.substring(e,t),u.forEach(function(e){var t=new RegExp(e,"gi");n=n.replace(t,'<span class="search-keyword">'+e+"</span>"),o=o.replace(t,'<span class="search-keyword">'+e+"</span>")}),m+='<div class="local-search__hit-item"><a href="'+s+'" class="search-result-title">'+o+"</a>",d+=1,""!==c&&(m+='<p class="search-result">'+n+"...</p>")),m+="</div>")}),0===d&&(m+='<div id="local-search__hits-empty">'+GLOBAL_CONFIG.localSearch.languages.hits_empty.replace(/\$\{query}/,this.value.trim())+"</div>"),m+="</div>",l.innerHTML=m,""!==u[0]&&(i.innerHTML=""),window.pjax&&window.pjax.refresh(l))});case 27:case"end":return e.stop()}},e)}))).apply(this,arguments)}t(),window.addEventListener("pjax:complete",function(){"block"===getComputedStyle(document.querySelector("#local-search .search-dialog")).display&&n(),t()})});